{"version":3,"kind":"Notebook","sha256":"e8b7e9bae349a330fc8fb3f50a22af1ef116684135be321956a381dc0f177edb","slug":"formation-energy","location":"/inorganic_materials/examples_tutorials/formation_energy.md","dependencies":[],"frontmatter":{"title":"Formation Energy","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.17.1"}},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"FAIR Chemistry & Collaborators","given":"FAIR Chemistry &","family":"Collaborators"},"name":"FAIR Chemistry & Collaborators","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/facebookresearch/fairchem","copyright":"Meta Platforms, Inc","numbering":{"title":{"offset":2}},"source_url":"https://github.com/facebookresearch/fairchem/blob/main/docs/inorganic_materials/examples_tutorials/formation_energy.md","edit_url":"https://github.com/facebookresearch/fairchem/edit/main/docs/inorganic_materials/examples_tutorials/formation_energy.md","exports":[{"format":"md","filename":"formation_energy.md","url":"/build/formation_energy-17a2f37aceefcb4587e7a550ecc32304.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"What You Will Learn","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"CWPF0skkxW"}],"key":"TAN8lmZBVA"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Calculate formation energies for inorganic materials using UMA with Materials Project-compatible corrections.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"VyyOMc1C8f"}],"key":"aYdDwKY5Vz"}],"key":"vDgwj4Wr9S"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"We’re going to start simple here - let’s run a local relaxation (optimize the unit cell and positions) using a pre-trained UMA model to compute formation energies for inorganic materials.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"Ow1F4uCgI7"}],"key":"CkNXsA0d2i"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Note predicting formation energy using models that models trained solely on OMat24 must use OMat24 compatible references and corrections for mixing PBE and PBE+U calculations. We use MP2020-style corrections fitted to OMat24 DFT calculations. For more information see the ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"m7i6KEJf0J"},{"type":"link","url":"https://docs.materialsproject.org/methodology/materials-methodology/thermodynamic-stability/thermodynamic-stability/anion-and-gga-gga+u-mixing","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"documentation","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"Ask3sVXq22"}],"urlSource":"https://docs.materialsproject.org/methodology/materials-methodology/thermodynamic-stability/thermodynamic-stability/anion-and-gga-gga+u-mixing","key":"SVBr7rUWMQ"},{"type":"text","value":" at the Materials Project. The necessary references can be found using the ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"O6ILj4eMW9"},{"type":"inlineCode","value":"fairchem.data.omat","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"bFHPgWuKQq"},{"type":"text","value":" package!","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"BcTmHSS0Nn"}],"key":"MBlrDzOD98"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Need to install fairchem-core or get UMA access or getting permissions/401 errors?","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"qYitMFnrXG"}],"key":"OzDCym6Who"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Install the necessary packages using pip, uv etc","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"oUuLuo6yvE"}],"key":"NfZMvPkqTy"}],"key":"GkTgySfeUK"}],"key":"VAaLUBivZP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"! pip install fairchem-core fairchem-data-omat","visibility":"show","key":"ze0HjuOcuK"},{"type":"outputs","id":"LRW7VurF9jTCFbbrIFqnB","children":[],"visibility":"show","key":"SgaDPB5qnp"}],"data":{"tags":["skip-execution"]},"visibility":"show","key":"A6QwjKPKeU"},{"type":"list","ordered":true,"start":2,"spread":false,"position":{"start":{"line":35,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":35,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Get access to any necessary huggingface gated models","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"D5bn7uMdRw"}],"key":"BpRevuOsm6"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":36,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Get and login to your Huggingface account","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"hv9e6JzyVQ"}],"key":"Gb7jw4TRdm"}],"key":"t5Tw25At3o"},{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Request access to ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"QVV17oOjnn"},{"type":"link","url":"https://huggingface.co/facebook/UMA","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"https://​huggingface​.co​/facebook​/UMA","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"SKvlVEfxGN"}],"urlSource":"https://huggingface.co/facebook/UMA","key":"X5nwakDWps"}],"key":"TCIWa9HIgh"}],"key":"XzWRdbAkvk"},{"type":"listItem","spread":true,"position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a Huggingface token at ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"j1KlE1mZ9y"},{"type":"link","url":"https://huggingface.co/settings/tokens/","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"https://​huggingface​.co​/settings​/tokens/","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"L4qvSBaw8Y"}],"urlSource":"https://huggingface.co/settings/tokens/","key":"gDejXESnG9"},{"type":"text","value":" with the permission “Permissions: Read access to contents of all public gated repos you can access”","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"xiPhXfAP8L"}],"key":"jgan9r8zwR"}],"key":"v8nFeliS2u"},{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Add the token as an environment variable using ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"wsbj2bcqDd"},{"type":"inlineCode","value":"huggingface-cli login","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"pkTmIexQPb"},{"type":"text","value":" or by setting the HF_TOKEN environment variable.","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"ZSGOVHC4im"}],"key":"FLyf5V6ulw"}],"key":"AaEAbuvaSC"}],"key":"vGiE1DIWfZ"}],"key":"JSGquSG6zG"}],"key":"u4p1H9Y0W1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Login using the huggingface-cli utility\n! huggingface-cli login\n\n# alternatively,\nimport os\nos.environ['HF_TOKEN'] = 'MY_TOKEN'","visibility":"show","key":"kalsycZLEL"},{"type":"outputs","id":"wtdsKths3_LgXL5bd7aCf","children":[],"visibility":"show","key":"U3Wez4xgLA"}],"data":{"tags":["skip-execution"]},"visibility":"show","key":"Zj612rVFH5"}],"class":"dropdown","key":"KcuBayehly"}],"key":"Z91B8W4H2Y"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from __future__ import annotations\n\nimport pprint\n\nfrom ase.build import bulk\nfrom ase.optimize import FIRE\nfrom quacc.recipes.mlp.core import relax_job\nfrom quacc import flow\nfrom fairchem.core.calculate import FAIRChemCalculator, FormationEnergyCalculator\n\n# Make an Atoms object of a bulk Cu structure\natoms = bulk(\"Cu\")\n\n# Run a structure relaxation\n@flow\ndef relax_flow(*args, **kwargs):\n  return relax_job(*args, **kwargs)\n\nresult = relax_flow(\n    atoms,\n    method=\"fairchem\",\n    name_or_path=\"uma-s-1p1\",\n    task_name=\"omat\",\n    relax_cell=True,\n    opt_params={\"fmax\": 1e-3, \"optimizer\": FIRE},\n)\n\n# Get the realxed atoms!\natoms = result[\"atoms\"]\n\n# Create an calculator using uma-s-1p1\ncalculator = FAIRChemCalculator.from_model_checkpoint(\"uma-s-1p1\", task_name=\"omat\")\n\n# Now use the FormationEnergyCalculator to calculate the formation energy\n# This will now return MP-style corrected formation energies\n# For the omat task, this defaults to apply MP2020 style corrections with OMat24 compatibility\nform_e_calc = FormationEnergyCalculator(calculator, apply_corrections=True)\natoms.calc = form_e_calc\nform_energy = atoms.get_potential_energy()","key":"vxz7LmUrNx"},{"type":"outputs","id":"Y2rKH8im1VBZSCmNM5bsr","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/checkpoints/uma-s-1p1.pt \"HTTP/1.1 302 Found\"\n"},"key":"YKPyfAO3Se"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/iso_atom_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"ANBqmCC9q0"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/form_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"UJ2D2AOIjD"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:device was not explicitly set, using device='cuda'.\n"},"key":"RVONBgycqz"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:The 'seed' argument is deprecated and will be removed in future versions. Please set the seed in the MLIPPredictUnit configuration instead.\n"},"key":"mOtjfIBf98"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:quacc.runners.prep:Calculation will run at /home/runner/work/fairchem/fairchem/docs/inorganic_materials/examples_tutorials/tmp-quacc-2026-02-17-21-17-17-312499-59941\n"},"key":"gfLISMEzX7"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:quacc.runners.prep:Calculation results stored at /home/runner/work/fairchem/fairchem/docs/inorganic_materials/examples_tutorials/quacc-2026-02-17-21-17-17-312499-59941\n"},"key":"f5lKgyJmJa"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/checkpoints/uma-s-1p1.pt \"HTTP/1.1 302 Found\"\n"},"key":"iLBMKqJ7uc"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/iso_atom_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"aSxyYtawVJ"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/form_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"XId24Q3EGU"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:device was not explicitly set, using device='cuda'.\n"},"key":"WTsncIMBMU"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:The 'seed' argument is deprecated and will be removed in future versions. Please set the seed in the MLIPPredictUnit configuration instead.\n"},"key":"qtdSAMqr0E"}],"key":"JKSUEGbVnf"}],"key":"GAlHSKM21z"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pprint.pprint(f\"Total energy: {result['results']['energy']} eV \\n Formation energy {form_energy} eV\")","key":"hkww7q81O4"},{"type":"outputs","id":"ktT4JBdovJyVqmoiVQt7_","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"('Total energy: -3.7502836815566587 eV \\n'\n ' Formation energy -0.005148701161303393 eV')\n"},"key":"VTsVmP3THj"}],"key":"aWacBHWD2q"}],"key":"UanHeBb6iA"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"Compare the results to the value of ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"FCBF4rsi3n"},{"type":"link","url":"https://next-gen.materialsproject.org/materials/mp-1265?chemsys=Mg-O#thermodynamic_stability","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"-3.038 eV/atom reported","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"Emnw7SHxB2"}],"urlSource":"https://next-gen.materialsproject.org/materials/mp-1265?chemsys=Mg-O#thermodynamic_stability","key":"TI7Aqw6oar"},{"type":"text","value":" in the Materials Project!\n","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"CszcYMf1A3"},{"type":"emphasis","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"Note that we expect differences due to the different DFT settings used to calculate the OMat24 training data.","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"nRjhanQ19d"}],"key":"KIuKiLnUaS"}],"key":"JXwtDJI79S"},{"type":"paragraph","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"Congratulations; you ran your first relaxation and predicted the formation energy of MgO using UMA and ","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"VMjHtB3YTt"},{"type":"inlineCode","value":"quacc","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"kqJLSXOr2m"},{"type":"text","value":"!","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"qCmWCInzPq"}],"key":"HnaJj0CxR1"}],"key":"aXm9ZzOTXD"}],"key":"BTwmW0XGdY"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Examples & Tutorials","url":"/summary-6","group":"Inorganic Materials"},"next":{"title":"Phonon Calculations","url":"/phonons","group":"Inorganic Materials"}}},"domain":"http://localhost:3000"}