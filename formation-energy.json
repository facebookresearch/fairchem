{"version":3,"kind":"Notebook","sha256":"e8b7e9bae349a330fc8fb3f50a22af1ef116684135be321956a381dc0f177edb","slug":"formation-energy","location":"/inorganic_materials/examples_tutorials/formation_energy.md","dependencies":[],"frontmatter":{"title":"Formation Energy","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.17.1"}},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"FAIR Chemistry & Collaborators","given":"FAIR Chemistry &","family":"Collaborators"},"name":"FAIR Chemistry & Collaborators","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/facebookresearch/fairchem","copyright":"Meta Platforms, Inc","numbering":{"title":{"offset":2}},"source_url":"https://github.com/facebookresearch/fairchem/blob/main/docs/inorganic_materials/examples_tutorials/formation_energy.md","edit_url":"https://github.com/facebookresearch/fairchem/edit/main/docs/inorganic_materials/examples_tutorials/formation_energy.md","exports":[{"format":"md","filename":"formation_energy.md","url":"/build/formation_energy-e3e8261231653f75af53132bf6a8d79f.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"What You Will Learn","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"GfFrggYq39"}],"key":"U3rxgsy3tU"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Calculate formation energies for inorganic materials using UMA with Materials Project-compatible corrections.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"HeY53gCPlJ"}],"key":"g7DQzLBU9z"}],"key":"IBPSKQgSCz"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"We’re going to start simple here - let’s run a local relaxation (optimize the unit cell and positions) using a pre-trained UMA model to compute formation energies for inorganic materials.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"PtxU3Cubga"}],"key":"clPL94b6cn"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Note predicting formation energy using models that models trained solely on OMat24 must use OMat24 compatible references and corrections for mixing PBE and PBE+U calculations. We use MP2020-style corrections fitted to OMat24 DFT calculations. For more information see the ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"zzizFQYHs0"},{"type":"link","url":"https://docs.materialsproject.org/methodology/materials-methodology/thermodynamic-stability/thermodynamic-stability/anion-and-gga-gga+u-mixing","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"documentation","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"T11GIdwwBK"}],"urlSource":"https://docs.materialsproject.org/methodology/materials-methodology/thermodynamic-stability/thermodynamic-stability/anion-and-gga-gga+u-mixing","key":"YW6J4XkUzp"},{"type":"text","value":" at the Materials Project. The necessary references can be found using the ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"qRWgJygD9l"},{"type":"inlineCode","value":"fairchem.data.omat","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"PWQwhffPpd"},{"type":"text","value":" package!","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"dr3q0mr8H8"}],"key":"txrfYLO9xB"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Need to install fairchem-core or get UMA access or getting permissions/401 errors?","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"YTZCxUj85q"}],"key":"I21RTD2lCN"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Install the necessary packages using pip, uv etc","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"vpTgUB0ecW"}],"key":"GVZ3SAKg0G"}],"key":"BoLkYe5YHP"}],"key":"bMGRbS1zFp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"! pip install fairchem-core fairchem-data-omat","visibility":"show","key":"G09A7A9IQY"},{"type":"outputs","id":"8T7y3lEr4Y3w7pAkBrXXQ","children":[],"visibility":"show","key":"di9H2W3Y6k"}],"data":{"tags":["skip-execution"]},"visibility":"show","key":"tojuMcidGE"},{"type":"list","ordered":true,"start":2,"spread":false,"position":{"start":{"line":35,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":35,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Get access to any necessary huggingface gated models","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"hgTF2oalsl"}],"key":"JvsETiNLxh"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":36,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Get and login to your Huggingface account","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"WdH24k1ua2"}],"key":"GpAP92QDhe"}],"key":"Gh3OzbzHQS"},{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Request access to ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"j8DsCO4rYV"},{"type":"link","url":"https://huggingface.co/facebook/UMA","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"https://​huggingface​.co​/facebook​/UMA","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"TqNdsSZg6I"}],"urlSource":"https://huggingface.co/facebook/UMA","key":"LQUpa5WHyE"}],"key":"OUCdisC8ih"}],"key":"OFHRRNCRWb"},{"type":"listItem","spread":true,"position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a Huggingface token at ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"rCNsqdIK6r"},{"type":"link","url":"https://huggingface.co/settings/tokens/","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"https://​huggingface​.co​/settings​/tokens/","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"m7LmpHMlXY"}],"urlSource":"https://huggingface.co/settings/tokens/","key":"b9cpIdvv9m"},{"type":"text","value":" with the permission “Permissions: Read access to contents of all public gated repos you can access”","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"roOkshuiYe"}],"key":"FYLRqeaYK7"}],"key":"zRlFWqTzsC"},{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Add the token as an environment variable using ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"RS8HbBoevC"},{"type":"inlineCode","value":"huggingface-cli login","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"Z6xIZiLiFB"},{"type":"text","value":" or by setting the HF_TOKEN environment variable.","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"K3M606kobM"}],"key":"PBmWzTX19T"}],"key":"qCz1V2ZYYy"}],"key":"GapstUmbUt"}],"key":"UsU2ec0z0z"}],"key":"ZqQV4W0tTK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Login using the huggingface-cli utility\n! huggingface-cli login\n\n# alternatively,\nimport os\nos.environ['HF_TOKEN'] = 'MY_TOKEN'","visibility":"show","key":"GPuuhi2BqC"},{"type":"outputs","id":"WtUh3lpvtLA_7RR64SbAU","children":[],"visibility":"show","key":"HxUiQvWCO7"}],"data":{"tags":["skip-execution"]},"visibility":"show","key":"g5cXEsFDts"}],"class":"dropdown","key":"vBebKonurj"}],"key":"AjFRhditkk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from __future__ import annotations\n\nimport pprint\n\nfrom ase.build import bulk\nfrom ase.optimize import FIRE\nfrom quacc.recipes.mlp.core import relax_job\nfrom quacc import flow\nfrom fairchem.core.calculate import FAIRChemCalculator, FormationEnergyCalculator\n\n# Make an Atoms object of a bulk Cu structure\natoms = bulk(\"Cu\")\n\n# Run a structure relaxation\n@flow\ndef relax_flow(*args, **kwargs):\n  return relax_job(*args, **kwargs)\n\nresult = relax_flow(\n    atoms,\n    method=\"fairchem\",\n    name_or_path=\"uma-s-1p1\",\n    task_name=\"omat\",\n    relax_cell=True,\n    opt_params={\"fmax\": 1e-3, \"optimizer\": FIRE},\n)\n\n# Get the realxed atoms!\natoms = result[\"atoms\"]\n\n# Create an calculator using uma-s-1p1\ncalculator = FAIRChemCalculator.from_model_checkpoint(\"uma-s-1p1\", task_name=\"omat\")\n\n# Now use the FormationEnergyCalculator to calculate the formation energy\n# This will now return MP-style corrected formation energies\n# For the omat task, this defaults to apply MP2020 style corrections with OMat24 compatibility\nform_e_calc = FormationEnergyCalculator(calculator, apply_corrections=True)\natoms.calc = form_e_calc\nform_energy = atoms.get_potential_energy()","key":"NyRyHMJLly"},{"type":"outputs","id":"tzYgYD_XdQ4PPiKYmeqSu","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/checkpoints/uma-s-1p1.pt \"HTTP/1.1 302 Found\"\n"},"key":"hLHTC3WYLS"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/iso_atom_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"SB9UBb840g"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/form_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"l0KGnd3dwu"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:device was not explicitly set, using device='cuda'.\n"},"key":"eUCCN9GPvY"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:The 'seed' argument is deprecated and will be removed in future versions. Please set the seed in the MLIPPredictUnit configuration instead.\n"},"key":"CGBbjPRi5j"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:quacc.runners.prep:Calculation will run at /home/runner/work/fairchem/fairchem/docs/inorganic_materials/examples_tutorials/tmp-quacc-2026-02-12-20-38-59-787469-59941\n"},"key":"CjB3byvp2Q"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:quacc.runners.prep:Calculation results stored at /home/runner/work/fairchem/fairchem/docs/inorganic_materials/examples_tutorials/quacc-2026-02-12-20-38-59-787469-59941\n"},"key":"Q0vNvcHLwE"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/checkpoints/uma-s-1p1.pt \"HTTP/1.1 302 Found\"\n"},"key":"rHa9DTuHzH"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/iso_atom_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"BbTJNlbizH"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/form_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"VYi15QLLus"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:device was not explicitly set, using device='cuda'.\n"},"key":"cDVsT6qlwt"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:The 'seed' argument is deprecated and will be removed in future versions. Please set the seed in the MLIPPredictUnit configuration instead.\n"},"key":"aZHeCTHc97"}],"key":"x0ls9SYpJH"}],"key":"QGRP8jwm03"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pprint.pprint(f\"Total energy: {result['results']['energy']} eV \\n Formation energy {form_energy} eV\")","key":"S2bjAWi1wz"},{"type":"outputs","id":"4XP8YRn_OLU8XxYvGJheg","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"('Total energy: -3.750283562347369 eV \\n'\n ' Formation energy -0.005148522347369067 eV')\n"},"key":"pmhb0LvRPe"}],"key":"PxLuztfV2q"}],"key":"wJySdU2K62"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"Compare the results to the value of ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"vafavzQO1z"},{"type":"link","url":"https://next-gen.materialsproject.org/materials/mp-1265?chemsys=Mg-O#thermodynamic_stability","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"-3.038 eV/atom reported","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"TZ6r1igSgT"}],"urlSource":"https://next-gen.materialsproject.org/materials/mp-1265?chemsys=Mg-O#thermodynamic_stability","key":"qqscorrmH6"},{"type":"text","value":" in the Materials Project!\n","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"lSaV5bP3zC"},{"type":"emphasis","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"Note that we expect differences due to the different DFT settings used to calculate the OMat24 training data.","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"oXtDXnVgoO"}],"key":"xSmIXJuj5w"}],"key":"elGhrLkGcS"},{"type":"paragraph","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"Congratulations; you ran your first relaxation and predicted the formation energy of MgO using UMA and ","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"gWi0ZPyQRY"},{"type":"inlineCode","value":"quacc","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"gSX54chSQq"},{"type":"text","value":"!","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"r1x3Ouefx6"}],"key":"wvwChB0GUw"}],"key":"e2prUKDkul"}],"key":"AemRvsiXna"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Examples & Tutorials","url":"/summary-6","group":"Inorganic Materials"},"next":{"title":"Phonon Calculations","url":"/phonons","group":"Inorganic Materials"}}},"domain":"http://localhost:3000"}