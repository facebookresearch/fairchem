{"version":3,"kind":"Notebook","sha256":"e8b7e9bae349a330fc8fb3f50a22af1ef116684135be321956a381dc0f177edb","slug":"formation-energy","location":"/inorganic_materials/examples_tutorials/formation_energy.md","dependencies":[],"frontmatter":{"title":"Formation Energy","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.17.1"}},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"FAIR Chemistry & Collaborators","given":"FAIR Chemistry &","family":"Collaborators"},"name":"FAIR Chemistry & Collaborators","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/facebookresearch/fairchem","copyright":"Meta Platforms, Inc","numbering":{"title":{"offset":2}},"source_url":"https://github.com/facebookresearch/fairchem/blob/main/docs/inorganic_materials/examples_tutorials/formation_energy.md","edit_url":"https://github.com/facebookresearch/fairchem/edit/main/docs/inorganic_materials/examples_tutorials/formation_energy.md","exports":[{"format":"md","filename":"formation_energy.md","url":"/build/formation_energy-03c7600a215332313301fdc6d9632dad.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"What You Will Learn","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"QemBaKP5vo"}],"key":"eDhxDgEZwt"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Calculate formation energies for inorganic materials using UMA with Materials Project-compatible corrections.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"EQzRiAjbC9"}],"key":"BnevtnKjZ9"}],"key":"OFdGXKnE4P"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"We’re going to start simple here - let’s run a local relaxation (optimize the unit cell and positions) using a pre-trained UMA model to compute formation energies for inorganic materials.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"TEoPpiCadQ"}],"key":"j09mjJGHou"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Note predicting formation energy using models that models trained solely on OMat24 must use OMat24 compatible references and corrections for mixing PBE and PBE+U calculations. We use MP2020-style corrections fitted to OMat24 DFT calculations. For more information see the ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"WLSyF1bpCs"},{"type":"link","url":"https://docs.materialsproject.org/methodology/materials-methodology/thermodynamic-stability/thermodynamic-stability/anion-and-gga-gga+u-mixing","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"documentation","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"JXUvJQ2bzT"}],"urlSource":"https://docs.materialsproject.org/methodology/materials-methodology/thermodynamic-stability/thermodynamic-stability/anion-and-gga-gga+u-mixing","key":"QOlVZXjpEk"},{"type":"text","value":" at the Materials Project. The necessary references can be found using the ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"YiibuYv1YZ"},{"type":"inlineCode","value":"fairchem.data.omat","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"eFvy77qHeK"},{"type":"text","value":" package!","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"DCNpKg61sx"}],"key":"Tpfg2po8YQ"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Need to install fairchem-core or get UMA access or getting permissions/401 errors?","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"rmKZSjtjNP"}],"key":"nCjOQRVdAI"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Install the necessary packages using pip, uv etc","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"d3y7bTekbf"}],"key":"tQQkxx55Uq"}],"key":"fgOLUQ4iap"}],"key":"gUhQeRx3KP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"! pip install fairchem-core fairchem-data-omat","visibility":"show","key":"NZxoU7zi5T"},{"type":"outputs","id":"toiD_kdalCsr0uwfsPn8J","children":[],"visibility":"show","key":"auXttD7AUk"}],"data":{"tags":["skip-execution"]},"visibility":"show","key":"v0ns4tSxRW"},{"type":"list","ordered":true,"start":2,"spread":false,"position":{"start":{"line":35,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":35,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Get access to any necessary huggingface gated models","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"BymFurZlGU"}],"key":"A3niC1PjdN"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":36,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Get and login to your Huggingface account","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"X2GV3Sg0oT"}],"key":"I9gKaoce93"}],"key":"OOeka26N1C"},{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Request access to ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"IhT1pGO1B0"},{"type":"link","url":"https://huggingface.co/facebook/UMA","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"https://​huggingface​.co​/facebook​/UMA","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"sXGeD30zXA"}],"urlSource":"https://huggingface.co/facebook/UMA","key":"iaer5ytrx3"}],"key":"pZMskzsOO9"}],"key":"wv8r87mJMr"},{"type":"listItem","spread":true,"position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a Huggingface token at ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"BToQ6CnU4q"},{"type":"link","url":"https://huggingface.co/settings/tokens/","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"https://​huggingface​.co​/settings​/tokens/","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"QOSI9JQQGt"}],"urlSource":"https://huggingface.co/settings/tokens/","key":"V4nbOzmlw9"},{"type":"text","value":" with the permission “Permissions: Read access to contents of all public gated repos you can access”","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"MWlQwehgmy"}],"key":"XxcqmM47Iz"}],"key":"Z1v6cg1R1Q"},{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Add the token as an environment variable using ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"f3CQF47QHh"},{"type":"inlineCode","value":"huggingface-cli login","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"OJ4eOza5oj"},{"type":"text","value":" or by setting the HF_TOKEN environment variable.","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"oJHSj8b666"}],"key":"Rt9cYjB3Db"}],"key":"wMdPXmdTOZ"}],"key":"wPBodI7OB6"}],"key":"hkuN5MuKMp"}],"key":"ak9ymt4ykn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Login using the huggingface-cli utility\n! huggingface-cli login\n\n# alternatively,\nimport os\nos.environ['HF_TOKEN'] = 'MY_TOKEN'","visibility":"show","key":"fKDfN6rHKu"},{"type":"outputs","id":"wsjaIcB3UJOeLsURhpre5","children":[],"visibility":"show","key":"y1X8qiBInJ"}],"data":{"tags":["skip-execution"]},"visibility":"show","key":"matd7iDag9"}],"class":"dropdown","key":"uA82173S76"}],"key":"WD3nXHSsEX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from __future__ import annotations\n\nimport pprint\n\nfrom ase.build import bulk\nfrom ase.optimize import FIRE\nfrom quacc.recipes.mlp.core import relax_job\nfrom quacc import flow\nfrom fairchem.core.calculate import FAIRChemCalculator, FormationEnergyCalculator\n\n# Make an Atoms object of a bulk Cu structure\natoms = bulk(\"Cu\")\n\n# Run a structure relaxation\n@flow\ndef relax_flow(*args, **kwargs):\n  return relax_job(*args, **kwargs)\n\nresult = relax_flow(\n    atoms,\n    method=\"fairchem\",\n    name_or_path=\"uma-s-1p1\",\n    task_name=\"omat\",\n    relax_cell=True,\n    opt_params={\"fmax\": 1e-3, \"optimizer\": FIRE},\n)\n\n# Get the realxed atoms!\natoms = result[\"atoms\"]\n\n# Create an calculator using uma-s-1p1\ncalculator = FAIRChemCalculator.from_model_checkpoint(\"uma-s-1p1\", task_name=\"omat\")\n\n# Now use the FormationEnergyCalculator to calculate the formation energy\n# This will now return MP-style corrected formation energies\n# For the omat task, this defaults to apply MP2020 style corrections with OMat24 compatibility\nform_e_calc = FormationEnergyCalculator(calculator, apply_corrections=True)\natoms.calc = form_e_calc\nform_energy = atoms.get_potential_energy()","key":"y2fSwqVQFZ"},{"type":"outputs","id":"zoootdQBbyKTx9dNr1Ktn","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"Warp DeprecationWarning: The symbol `warp.vec` will soon be removed from the public API. Use `warp.types.vector` instead.\n"},"key":"U14J1xqevx"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/checkpoints/uma-s-1p1.pt \"HTTP/1.1 302 Found\"\n"},"key":"UPhpj92gxl"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/iso_atom_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"yjIPp8JJv9"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/form_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"GLDAbaDrv5"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:device was not explicitly set, using device='cuda'.\n"},"key":"mDz5gznuvU"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:If 'dataset_list' is provided in the config, the code assumes that each dataset maps to itself. Please use 'dataset_mapping' as 'dataset_list' is deprecated and will be removed in the future.\n"},"key":"g4cWKwrtqh"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:The 'seed' argument is deprecated and will be removed in future versions. Please set the seed in the MLIPPredictUnit configuration instead.\n"},"key":"rpJZD3ciez"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:quacc.runners.prep:Calculation will run at /home/runner/work/fairchem/fairchem/docs/inorganic_materials/examples_tutorials/tmp-quacc-2026-02-25-22-50-03-725184-59941\n"},"key":"DKZzbTuhHL"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:quacc.runners.prep:Calculation results stored at /home/runner/work/fairchem/fairchem/docs/inorganic_materials/examples_tutorials/quacc-2026-02-25-22-50-03-725184-59941\n"},"key":"IFNo8xXVbc"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/checkpoints/uma-s-1p1.pt \"HTTP/1.1 302 Found\"\n"},"key":"KimBmlm9ph"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/iso_atom_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"OBixKAANNk"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/form_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"Tmb6y8DF5c"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:device was not explicitly set, using device='cuda'.\n"},"key":"IeeC8uEFxi"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:If 'dataset_list' is provided in the config, the code assumes that each dataset maps to itself. Please use 'dataset_mapping' as 'dataset_list' is deprecated and will be removed in the future.\n"},"key":"bo1tSfvt7X"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:The 'seed' argument is deprecated and will be removed in future versions. Please set the seed in the MLIPPredictUnit configuration instead.\n"},"key":"i7KfJilqmi"}],"key":"pmI6kXgMEb"}],"key":"v5dAeZ4i0W"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pprint.pprint(f\"Total energy: {result['results']['energy']} eV \\n Formation energy {form_energy} eV\")","key":"sl7QHg0c5c"},{"type":"outputs","id":"RbJiW9C7fxOUQCD7zNsWO","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"('Total energy: -3.7502836815566587 eV \\n'\n ' Formation energy -0.005148522347369067 eV')\n"},"key":"IFKVvWmlU7"}],"key":"VrIl13pAeN"}],"key":"USBMVnS6tR"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"Compare the results to the value of ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"aIyxZZ9SX5"},{"type":"link","url":"https://next-gen.materialsproject.org/materials/mp-1265?chemsys=Mg-O#thermodynamic_stability","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"-3.038 eV/atom reported","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"CGFpKxcc3N"}],"urlSource":"https://next-gen.materialsproject.org/materials/mp-1265?chemsys=Mg-O#thermodynamic_stability","key":"gh1IFVa4ms"},{"type":"text","value":" in the Materials Project!\n","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"by0hTJ9jmC"},{"type":"emphasis","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"Note that we expect differences due to the different DFT settings used to calculate the OMat24 training data.","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"tBISgVq8SW"}],"key":"WRNivx2SnI"}],"key":"SGD7vJzIPC"},{"type":"paragraph","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"Congratulations; you ran your first relaxation and predicted the formation energy of MgO using UMA and ","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"rh3KsxdBEl"},{"type":"inlineCode","value":"quacc","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"QU05MW4J74"},{"type":"text","value":"!","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"qIWVf4M2Wo"}],"key":"L1RSWGtctG"}],"key":"vSrwfQuHgd"}],"key":"rTnAkCU8wD"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Examples & Tutorials","url":"/summary-6","group":"Inorganic Materials"},"next":{"title":"Phonon Calculations","url":"/phonons","group":"Inorganic Materials"}}},"domain":"http://localhost:3000"}