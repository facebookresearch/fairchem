{"version":3,"kind":"Notebook","sha256":"e8b7e9bae349a330fc8fb3f50a22af1ef116684135be321956a381dc0f177edb","slug":"formation-energy","location":"/inorganic_materials/examples_tutorials/formation_energy.md","dependencies":[],"frontmatter":{"title":"Formation Energy","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.17.1"}},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"FAIR Chemistry & Collaborators","given":"FAIR Chemistry &","family":"Collaborators"},"name":"FAIR Chemistry & Collaborators","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/facebookresearch/fairchem","copyright":"Meta Platforms, Inc","numbering":{"title":{"offset":2}},"source_url":"https://github.com/facebookresearch/fairchem/blob/main/docs/inorganic_materials/examples_tutorials/formation_energy.md","edit_url":"https://github.com/facebookresearch/fairchem/edit/main/docs/inorganic_materials/examples_tutorials/formation_energy.md","exports":[{"format":"md","filename":"formation_energy.md","url":"/build/formation_energy-45ecd202cc623b78b94223259beae02d.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"What You Will Learn","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"t5vL9yGclF"}],"key":"M93AigqDex"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Calculate formation energies for inorganic materials using UMA with Materials Project-compatible corrections.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"yjyckLLrJx"}],"key":"WTVvqM7CyQ"}],"key":"NFKzOZBrIA"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"We’re going to start simple here - let’s run a local relaxation (optimize the unit cell and positions) using a pre-trained UMA model to compute formation energies for inorganic materials.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"GfvDG74OXM"}],"key":"tFCYfyrGL7"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Note predicting formation energy using models that models trained solely on OMat24 must use OMat24 compatible references and corrections for mixing PBE and PBE+U calculations. We use MP2020-style corrections fitted to OMat24 DFT calculations. For more information see the ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"NaKTGqKVJX"},{"type":"link","url":"https://docs.materialsproject.org/methodology/materials-methodology/thermodynamic-stability/thermodynamic-stability/anion-and-gga-gga+u-mixing","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"documentation","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"L9OqtXeOXd"}],"urlSource":"https://docs.materialsproject.org/methodology/materials-methodology/thermodynamic-stability/thermodynamic-stability/anion-and-gga-gga+u-mixing","key":"ugXOWwT5sP"},{"type":"text","value":" at the Materials Project. The necessary references can be found using the ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"jcyGVtQueh"},{"type":"inlineCode","value":"fairchem.data.omat","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"rtWWxpVSXA"},{"type":"text","value":" package!","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"UTTXvZ9EVv"}],"key":"xtgzd5lvL2"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Need to install fairchem-core or get UMA access or getting permissions/401 errors?","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"vR1hFp14t9"}],"key":"hsv136znKt"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Install the necessary packages using pip, uv etc","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"b5M2xg0NbM"}],"key":"qjRY1l1F2U"}],"key":"xz7Ldc3Z49"}],"key":"BYDgyMpwr3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"! pip install fairchem-core fairchem-data-omat","visibility":"show","key":"Gq5Qkd5Rqi"},{"type":"outputs","id":"HnxwrXgIv0bfRPS_XczFa","children":[],"visibility":"show","key":"jwxOXdRaPz"}],"data":{"tags":["skip-execution"]},"visibility":"show","key":"GIPfojODBz"},{"type":"list","ordered":true,"start":2,"spread":false,"position":{"start":{"line":35,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":35,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Get access to any necessary huggingface gated models","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"xkxsUTQ3wb"}],"key":"Gi7gNAMaVM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":36,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Get and login to your Huggingface account","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"vghdr6gtI4"}],"key":"JMiKgwsGjQ"}],"key":"tSw1TCn5IE"},{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Request access to ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"kUf2AEqOCx"},{"type":"link","url":"https://huggingface.co/facebook/UMA","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"https://​huggingface​.co​/facebook​/UMA","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"A1UiWacR7b"}],"urlSource":"https://huggingface.co/facebook/UMA","key":"BGqUvGBnHb"}],"key":"T5HEZXRTC8"}],"key":"c2FEvQq9lL"},{"type":"listItem","spread":true,"position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a Huggingface token at ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"lBAJagXa5k"},{"type":"link","url":"https://huggingface.co/settings/tokens/","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"https://​huggingface​.co​/settings​/tokens/","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"Evc7TFoSZh"}],"urlSource":"https://huggingface.co/settings/tokens/","key":"gRM86wRnQg"},{"type":"text","value":" with the permission “Permissions: Read access to contents of all public gated repos you can access”","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"R7oRoEpgn7"}],"key":"bTpfqsz8ty"}],"key":"ESx64ewqe1"},{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Add the token as an environment variable using ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"OndH9A7CsO"},{"type":"inlineCode","value":"huggingface-cli login","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"SahGL9Vqxr"},{"type":"text","value":" or by setting the HF_TOKEN environment variable.","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"cpiRJLaVbz"}],"key":"RJ1BY9jGGD"}],"key":"wWP2tRsxbv"}],"key":"SNPY7tO4to"}],"key":"oTK7JWjf2o"}],"key":"rHuEtLOWkb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Login using the huggingface-cli utility\n! huggingface-cli login\n\n# alternatively,\nimport os\nos.environ['HF_TOKEN'] = 'MY_TOKEN'","visibility":"show","key":"uBL5UIFSII"},{"type":"outputs","id":"7MvPGG7rS6ePCsDsOXFcj","children":[],"visibility":"show","key":"a272B1iMGu"}],"data":{"tags":["skip-execution"]},"visibility":"show","key":"JQvMkbAtyB"}],"class":"dropdown","key":"MQsKY6wZwq"}],"key":"dBNQz5Gi5T"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from __future__ import annotations\n\nimport pprint\n\nfrom ase.build import bulk\nfrom ase.optimize import FIRE\nfrom quacc.recipes.mlp.core import relax_job\nfrom quacc import flow\nfrom fairchem.core.calculate import FAIRChemCalculator, FormationEnergyCalculator\n\n# Make an Atoms object of a bulk Cu structure\natoms = bulk(\"Cu\")\n\n# Run a structure relaxation\n@flow\ndef relax_flow(*args, **kwargs):\n  return relax_job(*args, **kwargs)\n\nresult = relax_flow(\n    atoms,\n    method=\"fairchem\",\n    name_or_path=\"uma-s-1p1\",\n    task_name=\"omat\",\n    relax_cell=True,\n    opt_params={\"fmax\": 1e-3, \"optimizer\": FIRE},\n)\n\n# Get the realxed atoms!\natoms = result[\"atoms\"]\n\n# Create an calculator using uma-s-1p1\ncalculator = FAIRChemCalculator.from_model_checkpoint(\"uma-s-1p1\", task_name=\"omat\")\n\n# Now use the FormationEnergyCalculator to calculate the formation energy\n# This will now return MP-style corrected formation energies\n# For the omat task, this defaults to apply MP2020 style corrections with OMat24 compatibility\nform_e_calc = FormationEnergyCalculator(calculator, apply_corrections=True)\natoms.calc = form_e_calc\nform_energy = atoms.get_potential_energy()","key":"Ex0If3Os0j"},{"type":"outputs","id":"1YO_wm369xAHwGQ1he-oq","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/checkpoints/uma-s-1p1.pt \"HTTP/1.1 302 Found\"\n"},"key":"a05cQauciN"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/iso_atom_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"FTTFSHTYBA"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/form_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"qUDsmU1pqR"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:device was not explicitly set, using device='cuda'.\n"},"key":"aV9WKikDA7"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:If 'dataset_list' is provided in the config, the code assumes that each dataset maps to itself. Please use 'dataset_mapping' as 'dataset_list' is deprecated and will be removed in the future.\n"},"key":"dM0g68qnur"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:The 'seed' argument is deprecated and will be removed in future versions. Please set the seed in the MLIPPredictUnit configuration instead.\n"},"key":"dTO1eeoqI7"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:quacc.runners.prep:Calculation will run at /home/runner/work/fairchem/fairchem/docs/inorganic_materials/examples_tutorials/tmp-quacc-2026-02-20-23-04-15-581852-59941\n"},"key":"EifFii5jXE"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:quacc.runners.prep:Calculation results stored at /home/runner/work/fairchem/fairchem/docs/inorganic_materials/examples_tutorials/quacc-2026-02-20-23-04-15-581852-59941\n"},"key":"l1sNhBtZme"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/checkpoints/uma-s-1p1.pt \"HTTP/1.1 302 Found\"\n"},"key":"KTqBY7XneD"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/iso_atom_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"BVzWSFaZDT"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/form_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"d3yDjaobO2"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:device was not explicitly set, using device='cuda'.\n"},"key":"XFLINe3Syv"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:If 'dataset_list' is provided in the config, the code assumes that each dataset maps to itself. Please use 'dataset_mapping' as 'dataset_list' is deprecated and will be removed in the future.\n"},"key":"HS4UqJvXCo"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:The 'seed' argument is deprecated and will be removed in future versions. Please set the seed in the MLIPPredictUnit configuration instead.\n"},"key":"S6e5XFlnNY"}],"key":"zdoY9zlr2z"}],"key":"NhP7DqAG9N"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pprint.pprint(f\"Total energy: {result['results']['energy']} eV \\n Formation energy {form_energy} eV\")","key":"R6J1PJJR0c"},{"type":"outputs","id":"kY0XdaCU8uyq046ai252a","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"('Total energy: -3.7502837411613035 eV \\n'\n ' Formation energy -0.005148701161303393 eV')\n"},"key":"H53b5cn8WJ"}],"key":"k0V3fielLz"}],"key":"iya98doezu"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"Compare the results to the value of ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"HfzpjiEGSh"},{"type":"link","url":"https://next-gen.materialsproject.org/materials/mp-1265?chemsys=Mg-O#thermodynamic_stability","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"-3.038 eV/atom reported","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"nisBAduiuu"}],"urlSource":"https://next-gen.materialsproject.org/materials/mp-1265?chemsys=Mg-O#thermodynamic_stability","key":"zeFoPw6ftz"},{"type":"text","value":" in the Materials Project!\n","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"OdA0FqUHDv"},{"type":"emphasis","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"Note that we expect differences due to the different DFT settings used to calculate the OMat24 training data.","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"hulmK8cunh"}],"key":"CFfnuOHjUA"}],"key":"zx3KdkV8DZ"},{"type":"paragraph","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"Congratulations; you ran your first relaxation and predicted the formation energy of MgO using UMA and ","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"v8IpwY292e"},{"type":"inlineCode","value":"quacc","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"BG5YQeCr6o"},{"type":"text","value":"!","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"LcySl1JWkf"}],"key":"OfPVOFqKRe"}],"key":"qNxd52gZdm"}],"key":"dwAk9hHzd2"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Examples & Tutorials","url":"/summary-6","group":"Inorganic Materials"},"next":{"title":"Phonon Calculations","url":"/phonons","group":"Inorganic Materials"}}},"domain":"http://localhost:3000"}