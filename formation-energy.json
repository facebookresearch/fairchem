{"version":3,"kind":"Notebook","sha256":"571ce59c0aa8d254f6aec5e935ad303a3517317657e2dbd24e98c6baa506c260","slug":"formation-energy","location":"/inorganic_materials/examples_tutorials/formation_energy.md","dependencies":[],"frontmatter":{"title":"Formation Energy","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.17.1"}},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"FAIR Chemistry & Collaborators","given":"FAIR Chemistry &","family":"Collaborators"},"name":"FAIR Chemistry & Collaborators","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/facebookresearch/fairchem","copyright":"Meta Platforms, Inc","numbering":{"title":{"offset":2}},"source_url":"https://github.com/facebookresearch/fairchem/blob/main/docs/inorganic_materials/examples_tutorials/formation_energy.md","edit_url":"https://github.com/facebookresearch/fairchem/edit/main/docs/inorganic_materials/examples_tutorials/formation_energy.md","exports":[{"format":"md","filename":"formation_energy.md","url":"/build/formation_energy-49175dae8b9842ff3782ea15defa1e61.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"What You Will Learn","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"tpviAzna2e"}],"key":"kBlNltd08n"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Calculate formation energies for inorganic materials using UMA with Materials Project-compatible corrections.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"PleGgsUbL0"}],"key":"sw5kOw6nrF"}],"key":"c1QkUOu9JU"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"We’re going to start simple here - let’s run a local relaxation (optimize the unit cell and positions) using a pre-trained UMA model to compute formation energies for inorganic materials.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"UHQ1WUKyck"}],"key":"JU1DLZv9HO"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Note predicting formation energy using models that models trained solely on OMat24 must use OMat24 compatible references and corrections for mixing PBE and PBE+U calculations. We use MP2020-style corrections fitted to OMat24 DFT calculations. For more information see the ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"QlV8eCtYpw"},{"type":"link","url":"https://docs.materialsproject.org/methodology/materials-methodology/thermodynamic-stability/thermodynamic-stability/anion-and-gga-gga+u-mixing","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"documentation","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"nxNe2inWv6"}],"urlSource":"https://docs.materialsproject.org/methodology/materials-methodology/thermodynamic-stability/thermodynamic-stability/anion-and-gga-gga+u-mixing","key":"qh4CCUp6Oh"},{"type":"text","value":" at the Materials Project. The necessary references can be found using the ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"pQarZvXDMP"},{"type":"inlineCode","value":"fairchem.data.omat","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"OhdLdmsQtu"},{"type":"text","value":" package!","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"mvarikFezv"}],"key":"RiBHBCZKGE"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Need to install fairchem-core or get UMA access or getting permissions/401 errors?","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"BVkBun8aa5"}],"key":"V3pfqxwmcI"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Install the necessary packages using pip, uv etc","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"cJ2rDeCjqR"}],"key":"iDsOAKaTQm"}],"key":"spWrlzxYsH"}],"key":"R1WVhXCL6R"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"! pip install fairchem-core fairchem-data-omat","visibility":"show","key":"zOE1aZ9Qaq"},{"type":"outputs","id":"G6tgiPDBbC3goNwATa96P","children":[],"visibility":"show","key":"lttYvqEwWH"}],"data":{"tags":["skip-execution"]},"visibility":"show","key":"armAijRHpz"},{"type":"list","ordered":true,"start":2,"spread":false,"position":{"start":{"line":35,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":35,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Get access to any necessary huggingface gated models","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"MrsRBf3W1b"}],"key":"kMm6ApaydD"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":36,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Get and login to your Huggingface account","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"aoJxL5cgED"}],"key":"xEV5m4HnK9"}],"key":"rZRLe6pC5U"},{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Request access to ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"VOLz5dHCJ8"},{"type":"link","url":"https://huggingface.co/facebook/UMA","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"https://​huggingface​.co​/facebook​/UMA","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"U8zDeeJobj"}],"urlSource":"https://huggingface.co/facebook/UMA","key":"NLmySJha0X"}],"key":"Qqd2s18YJx"}],"key":"B8ZKMBsDSe"},{"type":"listItem","spread":true,"position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a Huggingface token at ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"lR5P2ysRZw"},{"type":"link","url":"https://huggingface.co/settings/tokens/","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"https://​huggingface​.co​/settings​/tokens/","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"LGIQ1q2eLX"}],"urlSource":"https://huggingface.co/settings/tokens/","key":"uC1HOkSHC2"},{"type":"text","value":" with the permission “Permissions: Read access to contents of all public gated repos you can access”","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"mWPoV8hCxf"}],"key":"My5mJo6CPB"}],"key":"VCYX3YkUYn"},{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Add the token as an environment variable using ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"WOEKQ27r5s"},{"type":"inlineCode","value":"huggingface-cli login","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"c0cDTPvKOH"},{"type":"text","value":" or by setting the HF_TOKEN environment variable.","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"vYYJLJJynf"}],"key":"NVmebDeAlq"}],"key":"xyUkz2xxB3"}],"key":"TIvURWEvgW"}],"key":"mMO7MW06ib"}],"key":"Rq0vcsgLLF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Login using the huggingface-cli utility\n! huggingface-cli login\n\n# alternatively,\nimport os\nos.environ['HF_TOKEN'] = 'MY_TOKEN'","visibility":"show","key":"pbGNmWrIG7"},{"type":"outputs","id":"jTjztCfxSzZqdJrGAPAp4","children":[],"visibility":"show","key":"arWJr6OUE1"}],"data":{"tags":["skip-execution"]},"visibility":"show","key":"tQpjZN7Px1"}],"class":"dropdown","key":"wByEaYKH9O"}],"key":"ZvSn2eCNgv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from __future__ import annotations\n\nimport pprint\n\nfrom ase.build import bulk\nfrom ase.optimize import FIRE\nfrom quacc.recipes.mlp.core import relax_job\nfrom quacc import flow\nfrom fairchem.core.calculate import FAIRChemCalculator, FormationEnergyCalculator\n\n# Make an Atoms object of a bulk Cu structure\natoms = bulk(\"Cu\")\n\n# Run a structure relaxation\n@flow\ndef relax_flow(*args, **kwargs):\n  return relax_job(*args, **kwargs)\n\nresult = relax_flow(\n    atoms,\n    method=\"fairchem\",\n    name_or_path=\"uma-s-1p1\",\n    task_name=\"omat\",\n    relax_cell=True,\n    opt_params={\"fmax\": 1e-3, \"optimizer\": FIRE},\n)\n\n# Get the realxed atoms!\natoms = result[\"atoms\"]\n\n# Create an calculator using uma-s-1p1\ncalculator = FAIRChemCalculator.from_model_checkpoint(\"uma-s-1p1\", task_name=\"omat\")\n\n# Now use the FormationEnergyCalculator to calculate the formation energy\n# This will now return MP-style corrected formation energies\n# For the omat task, this defaults to apply MP2020 style corrections with OMat24 compatibility\nform_e_calc = FormationEnergyCalculator(calculator, apply_corrections=True)\natoms.calc = form_e_calc\nform_energy = atoms.get_potential_energy()","key":"hhTl6Llpin"},{"type":"outputs","id":"GCI-3Fi6ZNlpLL7Sf3bI-","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/checkpoints/uma-s-1p1.pt \"HTTP/1.1 302 Found\"\n"},"key":"ASdRkrQlzR"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/iso_atom_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"pgLAXHRwuA"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/form_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"O0C0l7DJfc"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:device was not explicitly set, using device='cuda'.\n"},"key":"aHXgfy6Iap"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:The 'seed' argument is deprecated and will be removed in future versions. Please set the seed in the MLIPPredictUnit configuration instead.\n"},"key":"fwbUOGHBE0"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:quacc.runners.prep:Calculation will run at /home/runner/work/fairchem/fairchem/docs/inorganic_materials/examples_tutorials/tmp-quacc-2026-01-29-16-22-16-288470-59941\n"},"key":"IaH4PscbR2"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:quacc.runners.prep:Calculation results stored at /home/runner/work/fairchem/fairchem/docs/inorganic_materials/examples_tutorials/quacc-2026-01-29-16-22-16-288470-59941\n"},"key":"KChmWlixXX"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/checkpoints/uma-s-1p1.pt \"HTTP/1.1 302 Found\"\n"},"key":"SSL0XiFkgW"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/iso_atom_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"OghWjHqsFJ"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"INFO:httpx:HTTP Request: HEAD https://huggingface.co/facebook/UMA/resolve/main/references/form_elem_refs.yaml \"HTTP/1.1 200 OK\"\n"},"key":"XmGf2ewkfc"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:device was not explicitly set, using device='cuda'.\n"},"key":"sDMybzc9Ht"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"WARNING:root:The 'seed' argument is deprecated and will be removed in future versions. Please set the seed in the MLIPPredictUnit configuration instead.\n"},"key":"mBf5woYp2L"}],"key":"Rhv0jlDdZi"}],"key":"BDHAPT7M4I"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pprint.pprint(f\"Total energy: {result['results']['energy']} eV \\n Formation energy {form_energy} eV\")","key":"Ly2AzqAQHp"},{"type":"outputs","id":"3uKdiaevbIOWSBXBhlJa0","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"('Total energy: -3.7502837411613035 eV \\n'\n ' Formation energy -0.005148701161303393 eV')\n"},"key":"Ild8kuvhB0"}],"key":"WTXhnMTeTB"}],"key":"l9e8ZNbOon"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"Compare the results to the value of ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"vlo5TLhHZj"},{"type":"link","url":"https://next-gen.materialsproject.org/materials/mp-1265?chemsys=Mg-O#thermodynamic_stability","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"-3.038 eV/atom reported","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"XGJt5985BL"}],"urlSource":"https://next-gen.materialsproject.org/materials/mp-1265?chemsys=Mg-O#thermodynamic_stability","key":"gQZwy8LzXs"},{"type":"text","value":" in the the Materials Project!\n","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"H65HIdzPNg"},{"type":"emphasis","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"Note that we expect differences due to the different DFT settings used to calculate the OMat24 training data.","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"hLVCc2fx7v"}],"key":"ckgfO7SJEz"}],"key":"pSUFDPMgFb"},{"type":"paragraph","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"Congratulations; you ran your first relaxation and predicted the formation energy of MgO using UMA and ","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"o8NugJSjra"},{"type":"inlineCode","value":"quacc","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"Zy6AousqCo"},{"type":"text","value":"!","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"x3tcVXyY35"}],"key":"rgRuRiQOHg"}],"key":"zxmPsG65Qy"}],"key":"JiKsUxSuGb"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Examples & Tutorials","url":"/summary-6","group":"Inorganic Materials"},"next":{"title":"Phonon Calculations","url":"/phonons","group":"Inorganic Materials"}}},"domain":"http://localhost:3000"}