{"version":3,"kind":"Article","sha256":"c002fec9508bb15d0245e0f0be9df4caf75b3830aa9b1a6be36028cb0a63a582","slug":"training","location":"/core/common_tasks/training.md","dependencies":[],"frontmatter":{"title":"Training Models from Scratch","content_includes_title":false,"authors":[{"nameParsed":{"literal":"FAIR Chemistry & Collaborators","given":"FAIR Chemistry &","family":"Collaborators"},"name":"FAIR Chemistry & Collaborators","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/facebookresearch/fairchem","copyright":"Meta Platforms, Inc","numbering":{"title":{"offset":2}},"source_url":"https://github.com/facebookresearch/fairchem/blob/main/docs/core/common_tasks/training.md","edit_url":"https://github.com/facebookresearch/fairchem/edit/main/docs/core/common_tasks/training.md","exports":[{"format":"md","filename":"training.md","url":"/build/training-c1f412dd328ff50d9f7dfb9baa87a460.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This repo is used to train large state-of-the-art graph neural networks from scratch on datasets like OC20, OMol25, or OMat24, among others.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vK4SsxCYck"}],"key":"zTUBOJYkEO"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"Bh0ywnpc6O"}],"key":"u6LvFCCCz1"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"We now provide a simple CLI to handle this using your own custom datasets, but we suggest fine-tuning one of the existing checkpoints first before trying a from-scratch training.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Agr3PHE5FJ"}],"key":"JlItWPdbej"}],"key":"EAhwV8goyb"},{"type":"heading","depth":2,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"FAIRChem Training Framework Overview","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"gYUfkElah2"}],"identifier":"fairchem-training-framework-overview","label":"FAIRChem Training Framework Overview","html_id":"fairchem-training-framework-overview","implicit":true,"key":"o7Ue2tRYQA"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"The FAIRChem training framework currently uses a simple SPMD (Single Program Multiple Data) paradigm. It is made of several components:","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"HrlxfTf5Js"}],"key":"S7Ec10VC3K"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":13,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"User CLI and Launcher","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"u957K7o3CA"}],"key":"HKHSV0eRYW"},{"type":"text","value":" - The ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"EQM76Yjyej"},{"type":"inlineCode","value":"fairchem","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"rrjZGVpAa9"},{"type":"text","value":" CLI can run jobs locally using ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"zQqJpL91cA"},{"type":"link","url":"https://docs.pytorch.org/docs/stable/distributed.elastic.html","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"torch distributed elastic","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ibUmr2wLYw"}],"urlSource":"https://docs.pytorch.org/docs/stable/distributed.elastic.html","key":"e3vEXKyIPb"},{"type":"text","value":" or on ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"tX2qv56lfB"},{"type":"link","url":"https://slurm.schedmd.com/documentation.html","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"SLURM","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"WJQiC2rGXQ"}],"urlSource":"https://slurm.schedmd.com/documentation.html","key":"chiCziI7yI"},{"type":"text","value":". More environments may be supported in the future.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"P4dBbOLEyp"}],"key":"pzqnqqjG5k"}],"key":"E5EgOy5iVb"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Configuration","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"ELLjJwQtzw"}],"key":"URwNcNiQk7"},{"type":"text","value":" - We strictly use ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"H1djHZt1xz"},{"type":"link","url":"https://hydra.cc/docs/intro/","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Hydra YAMLs","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"DBKe0bpKEt"}],"urlSource":"https://hydra.cc/docs/intro/","key":"Y8MRNhXapI"},{"type":"text","value":" for configuration.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"y5ktyvy6bQ"}],"key":"lEyjVOgaF4"}],"key":"FdiECxRd9F"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Runner Interface","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"omOfIPqKmK"}],"key":"bxHQy0KYJr"},{"type":"text","value":" - The core program code that is replicated to run on all ranks. An optional Reducer is also available for evaluation jobs. Runners are distinct user functions that run on a single rank (i.e., GPU). They describe separate high-level tasks such as Train, Eval, Predict, Relaxations, MD, etc. Anyone can write a new runner if its functionality is sufficiently different than the ones that already exist.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"U3d6w4Ydmy"}],"key":"BUcCeWxHUo"}],"key":"hRQwn9dVXJ"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Trainer","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"nnUHCYBa5Z"}],"key":"rahOqzhHSn"},{"type":"text","value":" - We use ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"wWFnTXRkAi"},{"type":"link","url":"https://docs.pytorch.org/tnt/stable/","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"TorchTNT","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"nTdkslYsw1"}],"urlSource":"https://docs.pytorch.org/tnt/stable/","key":"jV3xiemBt1"},{"type":"text","value":" as a light-weight training loop. This allows us to cleanly separate the data loading from the training loop.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"RyWKU71yxl"}],"key":"XYeIfzacP8"}],"key":"oNOXOnK5hY"}],"key":"sQ1slY7Y6z"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"FWtydIJYFt"}],"key":"dtyABluhM9"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"TNT is PyTorch’s replacement for PyTorch Lightning - which has become severely bloated and difficult to use over the years; so we opted for the simpler option. Units are concepts in TorchTNT that provide a basic interface for training, evaluation, and prediction. These replace trainers in fairchemv1. You should write a new unit when the model paradigm is significantly different, e.g., training a Multitask-MLIP is one unit, training a diffusion model should be another unit.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"EdpApTu4pT"}],"key":"vLwzX1Of1a"}],"key":"edtYt7Grs5"},{"type":"heading","depth":2,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"FAIRChem v2 CLI","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"pXd35pE7jg"}],"identifier":"fairchem-v2-cli","label":"FAIRChem v2 CLI","html_id":"fairchem-v2-cli","implicit":true,"key":"FuyBISOfht"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"FAIRChem uses a single ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"DuUyaZTEz5"},{"type":"link","url":"https://github.com/facebookresearch/fairchem/blob/main/src/fairchem/core/_cli.py","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"CLI","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"fBEpnbqjTs"}],"urlSource":"https://github.com/facebookresearch/fairchem/blob/main/src/fairchem/core/_cli.py","data":{"kind":"file","org":"facebookresearch","repo":"fairchem","reference":"main","file":"src/fairchem/core/_cli.py","raw":"https://raw.githubusercontent.com/facebookresearch/fairchem/main/src/fairchem/core/_cli.py"},"internal":false,"protocol":"github","key":"c2YdlrL1vD"},{"type":"text","value":" for running jobs. It accepts a single argument, the location of the Hydra YAML.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"eN4PKltunV"}],"key":"ei5Xc4UEMY"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"kv7lHFBtBy"}],"key":"sLmoXgvspC"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"This is intentional to make sure all configuration is fully captured and avoid bloating of the command line interface. Because of the flexibility of Hydra YAMLs, you can still provide additional parameters and overrides using the ","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"TFO735OJMJ"},{"type":"link","url":"https://hydra.cc/docs/advanced/override_grammar/basic/","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"Hydra override syntax","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"aDMVJIVyhL"}],"urlSource":"https://hydra.cc/docs/advanced/override_grammar/basic/","key":"aMVYwVRWka"},{"type":"text","value":".","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"B5QRmhF9dY"}],"key":"U0lQJ7k10u"}],"key":"NHEumtgnJa"},{"type":"paragraph","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"The CLI can launch jobs locally using ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"ScoUIx0Dmb"},{"type":"link","url":"https://docs.pytorch.org/docs/stable/distributed.elastic.html","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"torch distributed elastic","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"fT0JXz5vOz"}],"urlSource":"https://docs.pytorch.org/docs/stable/distributed.elastic.html","key":"CqbwxSv8ur"},{"type":"text","value":" OR on ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"pkELTl7fXz"},{"type":"link","url":"https://slurm.schedmd.com/documentation.html","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"SLURM","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"tYD8ASzjZ2"}],"urlSource":"https://slurm.schedmd.com/documentation.html","key":"cTX6nxI4Lt"},{"type":"text","value":".","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"kPbjOhAhse"}],"key":"V3jcfPLQux"},{"type":"heading","depth":3,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"FAIRChem v2 Config Structure","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"FeIswTv6Ac"}],"identifier":"fairchem-v2-config-structure","label":"FAIRChem v2 Config Structure","html_id":"fairchem-v2-config-structure","implicit":true,"key":"wMVMiA5fYX"},{"type":"paragraph","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"A FAIRChem config is composed of only 2 valid top-level keys: ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"CVi8MuY1cM"},{"type":"strong","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"job","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"gkHnRCzjyg"}],"key":"nLvPbi3UgF"},{"type":"text","value":" (Job Config) and ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"teb6KUkoGg"},{"type":"strong","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"runner","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"jTXHJzJGWt"}],"key":"XN3Of8reIt"},{"type":"text","value":" (Runner Config). Additionally, you can add key/values that are used by the OmegaConf interpolation syntax to replace fields. Other than these, no other top-level keys are permitted.","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"uoHv8lGATO"}],"key":"ddiGJYT2Ah"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":40,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"JobConfig","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"YnWzNxYBfi"}],"key":"m0ZpUUpY9A"},{"type":"text","value":" represents configuration parameters that describe the overall job (mostly infra parameters) such as number of nodes, log locations, loggers, etc. This is a structured config and must strictly adhere to the JobConfig class.","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"V46Od1SWag"}],"key":"yvwyLCd6fI"}],"key":"xCdz51tFeN"},{"type":"listItem","spread":true,"position":{"start":{"line":41,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"Runner Config","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"W2zIRkyzsb"}],"key":"XclFvcg0AH"},{"type":"text","value":" describes the user code. This part of config is recursively instantiated at the start of a job using Hydra instantiation framework.","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"LkAl8l3m3E"}],"key":"M4tU4iHQTd"}],"key":"wGMviNeXmB"}],"key":"CuJ1iFlBIF"},{"type":"heading","depth":3,"position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"Example Configurations","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"hazFXax4JL"}],"identifier":"example-configurations","label":"Example Configurations","html_id":"example-configurations","implicit":true,"key":"C95j0CWJVr"},{"type":"paragraph","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"strong","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"Local run:","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"wY2CCOWtKr"}],"key":"ymAMaWo52b"}],"key":"lgC08cDcOX"},{"type":"code","lang":"yaml","value":"job:\n  device_type: CUDA\n  scheduler:\n    mode: LOCAL\n    ranks_per_node: 4\n  run_name: local_training_run","position":{"start":{"line":47,"column":1},"end":{"line":54,"column":1}},"key":"TX7nrqVBIH"},{"type":"paragraph","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"strong","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"text","value":"SLURM run:","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"W5f2RkxSEq"}],"key":"GHnBysailU"}],"key":"d5Iby6mnjI"},{"type":"code","lang":"yaml","value":"job:\n  device_type: CUDA\n  scheduler:\n    mode: SLURM\n    ranks_per_node: 8\n    num_nodes: 4\n    slurm:\n      account: ${cluster.account}\n      qos: ${cluster.qos}\n      mem_gb: ${cluster.mem_gb}\n      cpus_per_task: ${cluster.cpus_per_task}\n  run_dir: /path/to/output\n  run_name: slurm_run_example","position":{"start":{"line":58,"column":1},"end":{"line":72,"column":1}},"key":"uqs8Z5cYDW"},{"type":"heading","depth":3,"position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"text","value":"Config Object Instantiation","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"UV1ZDdl4wj"}],"identifier":"config-object-instantiation","label":"Config Object Instantiation","html_id":"config-object-instantiation","implicit":true,"key":"oAFG2v8It5"},{"type":"paragraph","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"text","value":"To keep our configs explicit (configs should be thought of as an extension of code), we prefer to use the Hydra instantiation framework throughout; the config is always fully described by a corresponding Python class and should never be a standalone dictionary.","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"DzROiDqu6M"}],"key":"w6pQkk4wlm"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Good vs Bad Config Patterns","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"nYNwE2AWdb"}],"key":"YSKQRk8Eed"},{"type":"paragraph","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"strong","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"Bad pattern","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"LE5KDifcfK"}],"key":"Ujk3hemS2Z"},{"type":"text","value":" - We have no idea where to find the code that uses runner or where variables x and y are actually used:","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"NRpMyfeXJO"}],"key":"NEK7XekeRa"},{"type":"code","lang":"yaml","value":"runner:\n  x: 5\n  y: 6","position":{"start":{"line":83,"column":1},"end":{"line":87,"column":1}},"key":"IwI3W0r6dA"},{"type":"paragraph","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"strong","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"Good pattern","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"jJD0nkK2xi"}],"key":"ongXTPasdk"},{"type":"text","value":" - Now we know which class runner corresponds to and that x, y are just initializer variables of runner. If we need to check the definition or understand the code, we can simply go to runner.py:","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"WGVlT57kFK"}],"key":"yGEqOWKFxk"},{"type":"code","lang":"yaml","value":"runner:\n  _target_: fairchem.core.components.runner.Runner\n  x: 5\n  y: 6","position":{"start":{"line":91,"column":1},"end":{"line":96,"column":1}},"key":"gLbSp94IOz"}],"class":"dropdown","key":"l6WCqzFdrk"},{"type":"heading","depth":3,"position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"Runtime Instantiation with Partial Functions","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"POoimFKOQU"}],"identifier":"runtime-instantiation-with-partial-functions","label":"Runtime Instantiation with Partial Functions","html_id":"runtime-instantiation-with-partial-functions","implicit":true,"key":"yk9EK4wnRv"},{"type":"paragraph","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"text","value":"While we want to use static instantiation as much as possible, there will be many cases where certain objects require runtime inputs to create. For example, if we want to create a PyTorch optimizer, we can give it all the arguments except the model parameters (because it’s only known at runtime).","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"fH6GLV0KxZ"}],"key":"sglRD7j2Ox"},{"type":"code","lang":"yaml","value":"optimizer:\n  _target_: torch.optim.AdamW\n  params: ?? # this is only known at runtime\n  lr: 8e-4\n  weight_decay: 1e-3","position":{"start":{"line":103,"column":1},"end":{"line":109,"column":1}},"key":"uju8aoF3qR"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"iPSzu0vq1G"}],"key":"c1Tt9BeJQj"},{"type":"paragraph","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"children":[{"type":"text","value":"In this case we can use a partial function. Instead of creating an optimizer object, we create a Python partial function that can then be used to instantiate the optimizer in code later:","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"key":"Jo4rVujr5v"}],"key":"Wiy67d9lCt"}],"key":"cdmNDpG3Ab"},{"type":"code","lang":"yaml","value":"optimizer_fn:\n  _target_: torch.optim.AdamW\n  _partial_: true\n  lr: 8e-4\n  weight_decay: 1e-3","position":{"start":{"line":115,"column":1},"end":{"line":121,"column":1}},"key":"M76fuiJjm4"},{"type":"code","lang":"python","value":"# later in the runner\noptimizer = optimizer_fn(model.parameters())","position":{"start":{"line":123,"column":1},"end":{"line":126,"column":1}},"key":"fx1qWESoP2"},{"type":"heading","depth":2,"position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"children":[{"type":"text","value":"Training UMA","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"NM3Lg4FXKs"}],"identifier":"training-uma","label":"Training UMA","html_id":"training-uma","implicit":true,"key":"kiPm01icMC"},{"type":"paragraph","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"children":[{"type":"text","value":"The UMA model is completely defined ","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"PJl0N2Nvs4"},{"type":"link","url":"https://github.com/facebookresearch/fairchem/tree/main/src/fairchem/core/models/uma","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"VsM3v98Obd"}],"urlSource":"https://github.com/facebookresearch/fairchem/tree/main/src/fairchem/core/models/uma","error":true,"key":"GyOV6ZRxip"},{"type":"text","value":". It is also called “escn_md” during internal development since it was based on the eSEN architecture.","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"xpjFAGXvwN"}],"key":"Ifj27QmUI8"},{"type":"paragraph","position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"children":[{"type":"text","value":"Training, evaluation, and inference are all defined in the ","position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"key":"h5Z1Rf4g6f"},{"type":"link","url":"https://github.com/facebookresearch/fairchem/blob/main/src/fairchem/core/units/mlip_unit/mlip_unit.py","position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"children":[{"type":"text","value":"mlip unit","position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"key":"akihSu97NJ"}],"urlSource":"https://github.com/facebookresearch/fairchem/blob/main/src/fairchem/core/units/mlip_unit/mlip_unit.py","data":{"kind":"file","org":"facebookresearch","repo":"fairchem","reference":"main","file":"src/fairchem/core/units/mlip_unit/mlip_unit.py","raw":"https://raw.githubusercontent.com/facebookresearch/fairchem/main/src/fairchem/core/units/mlip_unit/mlip_unit.py"},"internal":false,"protocol":"github","key":"avrId13Shz"},{"type":"text","value":".","position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"key":"Bf4S6uvKp4"}],"key":"VvDKyJJFUu"},{"type":"paragraph","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"text","value":"To train a model, we need to initialize a ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"mfAQCnXa6C"},{"type":"link","url":"https://github.com/facebookresearch/fairchem/blob/main/src/fairchem/core/components/train/train_runner.py","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"text","value":"TrainRunner","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"dZnrBG1D6v"}],"urlSource":"https://github.com/facebookresearch/fairchem/blob/main/src/fairchem/core/components/train/train_runner.py","data":{"kind":"file","org":"facebookresearch","repo":"fairchem","reference":"main","file":"src/fairchem/core/components/train/train_runner.py","raw":"https://raw.githubusercontent.com/facebookresearch/fairchem/main/src/fairchem/core/components/train/train_runner.py"},"internal":false,"protocol":"github","key":"H4fvGmf9AZ"},{"type":"text","value":" with a ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"K5La6s1eag"},{"type":"link","url":"https://github.com/facebookresearch/fairchem/blob/main/src/fairchem/core/units/mlip_unit/mlip_unit.py","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"text","value":"MLIPTrainEvalUnit","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"va2YarGtTW"}],"urlSource":"https://github.com/facebookresearch/fairchem/blob/main/src/fairchem/core/units/mlip_unit/mlip_unit.py","data":{"kind":"file","org":"facebookresearch","repo":"fairchem","reference":"main","file":"src/fairchem/core/units/mlip_unit/mlip_unit.py","raw":"https://raw.githubusercontent.com/facebookresearch/fairchem/main/src/fairchem/core/units/mlip_unit/mlip_unit.py"},"internal":false,"protocol":"github","key":"rv3XaInm5A"},{"type":"text","value":".","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"vU5jm9xgAK"}],"key":"jQc51idZ2C"},{"type":"paragraph","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"children":[{"type":"text","value":"Due to the complexity of UMA and training a multi-architecture, multi-dataset, multi-task model, we leverage ","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"key":"UtPrB3Zv2z"},{"type":"link","url":"https://hydra.cc/docs/tutorials/basic/your_first_app/config_groups/","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"children":[{"type":"text","value":"config groups","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"key":"AGXe7vJIbi"}],"urlSource":"https://hydra.cc/docs/tutorials/basic/your_first_app/config_groups/","key":"FUguVfXFNu"},{"type":"text","value":" syntax in Hydra to organize UMA training into the ","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"key":"rlcmrnu6wo"},{"type":"link","url":"https://github.com/facebookresearch/fairchem/tree/main/configs/uma/training_release","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"children":[{"type":"text","value":"following sections","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"key":"t7W1lzDhL9"}],"urlSource":"https://github.com/facebookresearch/fairchem/tree/main/configs/uma/training_release","error":true,"key":"ohJIMlEyMA"},{"type":"text","value":":","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"key":"wC9eoRXcMX"}],"key":"G7GpFYZqNl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":138,"column":1},"end":{"line":143,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":138,"column":1},"end":{"line":138,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":138,"column":1},"end":{"line":138,"column":1}},"children":[{"type":"text","value":"backbone","position":{"start":{"line":138,"column":1},"end":{"line":138,"column":1}},"key":"C9FmYNyAyz"}],"key":"p0bFRMX3N7"},{"type":"text","value":" - selects the specific backbone architecture (e.g., uma-sm, uma-md, uma-large)","position":{"start":{"line":138,"column":1},"end":{"line":138,"column":1}},"key":"HUHFmtoQbC"}],"key":"piRzpglGmh"}],"key":"HMqjrkbWuZ"},{"type":"listItem","spread":true,"position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"children":[{"type":"text","value":"cluster","position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"key":"QQYhWx3K8x"}],"key":"SntWPx38po"},{"type":"text","value":" - quickly switch settings between different SLURM clusters or local environment","position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"key":"xM1y6GWTBH"}],"key":"iwws5DXsB0"}],"key":"GWNRaS0i3I"},{"type":"listItem","spread":true,"position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"text","value":"dataset","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"R5zieKzr8q"}],"key":"yOAwDOOV2D"},{"type":"text","value":" - select the dataset to train on","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"oG1z469j4e"}],"key":"UPNoeasXzC"}],"key":"TEx1DUj13G"},{"type":"listItem","spread":true,"position":{"start":{"line":141,"column":1},"end":{"line":141,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":141,"column":1},"end":{"line":141,"column":1}},"children":[{"type":"text","value":"element_refs","position":{"start":{"line":141,"column":1},"end":{"line":141,"column":1}},"key":"aZqyjZlg4n"}],"key":"xedHeLTu1g"},{"type":"text","value":" - select the element references","position":{"start":{"line":141,"column":1},"end":{"line":141,"column":1}},"key":"HM80KEa5e7"}],"key":"Dcudc5JLum"}],"key":"UeufsWt0oo"},{"type":"listItem","spread":true,"position":{"start":{"line":142,"column":1},"end":{"line":143,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"children":[{"type":"text","value":"tasks","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"key":"i4ydQNoJHg"}],"key":"jDf32qCtPv"},{"type":"text","value":" - select the task set (e.g., for direct or conservative training)","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"key":"ED3v9MuIaR"}],"key":"Wk0SrDA8VO"}],"key":"ITi9jhFrsB"}],"key":"goKsZyNnf1"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"TKn8BAjYr6"}],"key":"ItFIB69vdY"},{"type":"paragraph","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"children":[{"type":"text","value":"We can switch between different combinations of configs easily this way!","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"key":"aKpe5kSS4w"}],"key":"ljxSCPClEg"}],"key":"fgUmfIrHLz"},{"type":"heading","depth":3,"position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"children":[{"type":"text","value":"Example Commands","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"sOw1Cw6UVH"}],"identifier":"example-commands","label":"Example Commands","html_id":"example-commands","implicit":true,"key":"JZ0pwmWWJC"},{"type":"paragraph","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"strong","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"text","value":"Get training started locally using local settings and the debug dataset:","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"lEp8s7p0IC"}],"key":"m41fjM4Hjg"}],"key":"CwW7g2p7sc"},{"type":"code","lang":"bash","value":"fairchem -c configs/uma/training_release/uma_sm_direct_pretrain.yaml cluster=h100_local dataset=uma_debug","position":{"start":{"line":152,"column":1},"end":{"line":154,"column":1}},"key":"WK6FVCP2Ba"},{"type":"paragraph","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"strong","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"text","value":"Train UMA conservative with 16 nodes on SLURM:","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"MnfOql8XkK"}],"key":"A4MojUWjEg"}],"key":"mNlO2FtELF"},{"type":"code","lang":"bash","value":"fairchem -c configs/uma/training_release/uma_sm_conserve_finetune.yaml cluster=h100 job.scheduler.num_nodes=16 run_name=\"uma_conserve_train\"","position":{"start":{"line":158,"column":1},"end":{"line":160,"column":1}},"key":"FeFnvalcQN"}],"key":"YIr6tHfJto"}],"key":"TYiPhNNYxE"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"FAIRChem and Custom Datasets","url":"/ase-dataset-creation","group":"AI/ML Models & Usage"},"next":{"title":"Evaluating Pretrained Models","url":"/evaluation","group":"AI/ML Models & Usage"}}},"domain":"http://localhost:3000"}